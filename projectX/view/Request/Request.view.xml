<mvc:View
        controllerName="projectX.view.Request.Request"
        xmlns:mvc="sap.ui.core.mvc"
        xmlns:core="sap.ui.core"
        xmlns:l="sap.ui.layout"
        xmlns="sap.m"
        xmlns:u="sap.ui.unified"
        xmlns:html="http://www.w3.org/1999/xhtml"
        xmlns:custom="projectX.util">
    <Page showNavButton="{device>/isPhone}"
          navButtonPress="onNavBack"
          enableScrolling="false"
          showHeader="false"
          title="{localUIModel>/name}">
        <subHeader>
            <Toolbar>
                <ToolbarSpacer/>
                <Label text="Status: {localUIModel>/request/mProperties/status}
                Time: {localUIModel>/request/mProperties/responseTime}ms"/>
                <Button text="Send Request"
                        press="onBtnSendPress"
                        type="Emphasized"/>
            </Toolbar>
        </subHeader>

        <content>

            <ScrollContainer
                    visible="{localUIModel>/requestVisible}"
                    height="100%"
                    width="100%"
                    horizontal="false"
                    vertical="true">

                <Input value="{localUIModel>/request/mProperties/name}"
                       placeholder="name of request"
                       liveChange="onNameChanged"
                       valueLiveUpdate="true"
                        />
                <VBox>
                  <CheckBox text="use project prefix url: {localUIModel>/project/mProperties/prefixUrl}"
                            selected="{localUIModel>/request/mProperties/useProjectPrefixUrl}"
                            select="onCBPrefixSelected"/>
                  <CheckBox text="get CRSF token from {localUIModel>/project/mProperties/baseUrl}"
                            selected="{localUIModel>/request/mProperties/fetchCSRFToken}"/>  
                  <Select selectedKey="{localUIModel>/request/mProperties/httpMethod}"
                          items="{localUIModel>/HTTP_METHODS}">
                      <core:Item text="{localUIModel>key}" key="{localUIModel>key}"/>
                  </Select>
                </VBox>
                
                <FlexBox
                        width="100%"
                        alignItems="Start">
                    
                    <TextArea value="{localUIModel>/request/mProperties/url}"
                              id="idTextAreaUrl"
                              placeholder="Enter valid Service-URL ..."
                              rows="4"
                              width="100%"
                            >
                        <layoutData>
                            <FlexItemData growFactor="1"/>
                        </layoutData>
                    </TextArea>
                    <VBox>
                        <Button press="onBtnSendPress" text="Send"/>
                        <!-- <Button press="onBtnMetadataPress" text="OData"/> -->
                        <!-- <Popover id="idMetadataPopover"
                                 title="OData Request Helper"
                                 horizontalScrolling="false"
                                 contentWidth="98%"
                                 contentHeight="98%"
                                 placement="Bottom">
                            <VBox id="idVBoxMetadataTypesPlaceholder"/>
                        </Popover> -->
                    </VBox>
                </FlexBox>

                <Panel expandable="true"
                       expanded="false"
                       class="sapUiNoContentPadding"
                       >
                       <headerToolbar>
                         <Toolbar design="Transparent" height="3rem">
                          <Text text="Assertions ({localUIModel>/request/mAggregations/assertions/length})"/>
                          <core:Icon src="{ parts : [
                            								{ path : 'localUIModel>/request/mProperties/assertionsResult' },
                            								{ path : 'localUIModel>/request/mProperties/assertionsResultReady' }
                            							],
                            							formatter : 'projectX.util.Formatter.assertionsResultToImage' }"/>
                        </Toolbar>
                       </headerToolbar>
                  <VBox id="idVBoxAssertionPlaceholder"/>
                </Panel>


                <Panel expandable="true"
                       expanded="false"
                       expand="onPanelPrescriptExpand"
                       class="sapUiNoContentPadding"
                       >
                       <headerToolbar>
                         <Toolbar design="Transparent" height="3rem">
                          <Text text="Pre-request script ({localUIModel>/request/mProperties/scriptCode/length})"/>
                        </Toolbar>
                       </headerToolbar>
                    <FlexBox width="100%">
                        <VBox>
                            <layoutData>
                                <FlexItemData growFactor="8"/>
                            </layoutData>

                            <custom:AceEditor width="100%" height="200px"
                                              value="{localUIModel>/request/mProperties/scriptCode}"
                                              id="superEditor"
                                    />
                        </VBox>
                        <VBox>
                            <layoutData>
                                <FlexItemData shrinkFactor="0"
                                        />
                            </layoutData>
                            <Button text="Snippets" press="onButtonScriptExamples"/>
                            <u:Menu items="{localUIModel>/SCRIPT_EXAMPLES}"
                                    id="idMenuScriptExamples">
                                <u:MenuItem text="{localUIModel>text}"
                                            select="onMenuItemScriptExampleSelected"/>
                            </u:Menu>
                        </VBox>
                    </FlexBox>
                </Panel>
                <Panel expandable="true"
                       expanded="false"
                       headerText="Request Headers ({localUIModel>/request/mAggregations/requestHeaders/length})"
                       class="sapUiNoContentPadding"
                        >
                    <VBox id="idVBoxRequestHeaderPlaceholder"/>
                </Panel>

                <Panel expandable="true"
                       expanded="false"
                       expand="onPanelRequestBodyExpand"
                       class="sapUiNoContentPadding"
                       >
                       <headerToolbar>
                         <Toolbar design="Transparent" height="3rem">
                          <Text text="Request Payload ({localUIModel>/request/mProperties/requestBody/length})"/>
                        </Toolbar>
                       </headerToolbar>
                    <custom:AceEditor width="100%" height="200px"
                                      value="{localUIModel>/request/mProperties/requestBody}"
                                      id="superEditorRequestBody"
                                      />
                </Panel>


                <Panel expandable="true"
                       expanded="true"
                       class="sapUiNoContentPadding"
                        >
                        <headerToolbar>
                          <Toolbar design="Transparent" height="3rem">
                           <Text text="Response Headers ({localUIModel>/request/mProperties/responseHeaders/length})"/>
                         </Toolbar>
                        </headerToolbar>
                    <custom:AceEditor width="100%" height="auto"
                                      mode="text"
                                      readOnly="true"
                                      value="{localUIModel>/request/mProperties/responseHeaders}"
                                      id="superEditor3"
                                      autoHeightMode="true"
                                      enableWrapMode="true"
                            />
                </Panel>

                <VBox>
                    <Label text="Response Body"/>
                    <SegmentedButton 
                                     select="onResponseBodyFormat"
                                     id="idButtonResponseFormat">
                        <Button text="XML" id="idButtonResponseXML"/>
                        <Button text="JSON" id="idButtonResponseJSON"/>
                        <Button text="HTML" id="idButtonResponseHTML"/>
                        <Button text="RAW" id="idButtonResponseRAW"/>
                    </SegmentedButton>
                </VBox>
                <custom:AceEditor width="100%" height="auto" class="projectXAceNoScroll"
                                  mode="{localUIModel>/responseBodyDisplayMode}"
                                  readOnly="true"
                                  value="{localUIModel>/responseBodyFormatted}"
                                  id="superEditor2"
                                  autoHeightMode="true"
                                  enableWrapMode="true"
                        />

            </ScrollContainer>
        </content>
    </Page>
</mvc:View>
